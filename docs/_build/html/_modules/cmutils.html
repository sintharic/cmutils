<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cmutils &mdash; stlutils 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> stlutils
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">cmutils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">stlutils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>cmutils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for cmutils</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">------------------------------------</span>
<span class="sd">  Post-Processing of contMech Data</span>
<span class="sd">------------------------------------</span>

<span class="sd">@author: thescientist</span>
<span class="sd">&quot;&quot;&quot;</span>



<span class="c1">#%% ----- User presets ----- %%#</span>

<span class="n">XLIM</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>   <span class="c1"># default xrange</span>
<span class="n">YLIM</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>   <span class="c1"># default yrange</span>
<span class="n">ZLIM</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>       <span class="c1"># default zrange</span>
<span class="n">SHOW</span> <span class="o">=</span> <span class="kc">True</span>         <span class="c1"># show plot windows</span>
<span class="n">FMT</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.6g</span><span class="s2">&quot;</span>       <span class="c1"># number format used to write data to files</span>
<span class="n">ROT</span>  <span class="o">=</span> <span class="kc">True</span>         <span class="c1"># make imshow orient along real coords rather than indices</span>

<span class="n">WARN</span> <span class="o">=</span> <span class="kc">False</span>        <span class="c1"># display non-critical warnings and reminders</span>





<span class="c1">#%% ----- Plotting ----- %%#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span><span class="p">,</span> <span class="n">double</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#from tqdm import tqdm # tqdm 3rdPartyModule</span>


<div class="viewcode-block" id="show"><a class="viewcode-back" href="../cmutils.html#cmutils.show">[docs]</a><span class="k">def</span> <span class="nf">show</span><span class="p">():</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plotImg"><a class="viewcode-back" href="../cmutils.html#cmutils.plotImg">[docs]</a><span class="k">def</span> <span class="nf">plotImg</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">ZLIM</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;turbo&quot;</span><span class="p">,</span> 
            <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">cba</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="n">ROT</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; plot array as an image</span>
<span class="sd">    </span>
<span class="sd">    plots 2D numpy.ndarray &lt;array&gt; as a colored image, similar to gnuplot&#39;s </span>
<span class="sd">    &quot;splot ... with pm3d&quot;.</span>
<span class="sd">    &lt;clim&gt; must be of form (v_min,v_max), the value range to which colors are mapped.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.axes.Axes object containing the plot</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">rot</span><span class="p">:</span> 
        <span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;lower&quot;</span>
        <span class="n">arrayLoc</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;upper&quot;</span>
        <span class="n">arrayLoc</span> <span class="o">=</span> <span class="n">array</span>

    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">aspect</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span> <span class="n">aspect</span> <span class="o">=</span> <span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arrayLoc</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clim</span><span class="o">!=</span><span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">clim</span><span class="p">(</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="n">cba</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">cba</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">set_powerlimits</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_offset_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arrayLoc</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clim</span><span class="o">!=</span><span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span></div>


<div class="viewcode-block" id="plotLines"><a class="viewcode-back" href="../cmutils.html#cmutils.plotLines">[docs]</a><span class="k">def</span> <span class="nf">plotLines</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; plot line scan(s)</span>
<span class="sd">    </span>
<span class="sd">    plots line(s) along dimension &lt;dim&gt; from numpy.ndarray &lt;array&gt;.</span>
<span class="sd">    &lt;lines&gt; can be an int or a list/tuple of ints with desired line indices.</span>
<span class="sd">    &lt;axis&gt;, the matplotlib.axes.Axes object on which to plot, can be specified.</span>
<span class="sd">    as well as typical kwargs for plots.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.axes.Axes object containing the plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">xlab</span><span class="o">=</span><span class="s2">&quot;X&quot;</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">xlab</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span><span class="n">line</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">line</span><span class="p">,:]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">axis</span><span class="p">:</span> <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">ls</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;line &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">),</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">ls</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;line &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">),</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">axis</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Height&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span></div>


<div class="viewcode-block" id="plotSurf"><a class="viewcode-back" href="../cmutils.html#cmutils.plotSurf">[docs]</a><span class="k">def</span> <span class="nf">plotSurf</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">ZLIM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;turbo&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lc</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">aa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; plot 3D view of surface</span>
<span class="sd">    </span>
<span class="sd">    plots 2D numpy.ndarray &lt;array&gt;, using the data as z values, in a 3D view.</span>
<span class="sd">    </span>
<span class="sd">    for &lt;kind&gt;=&quot;color&quot;, the color map &lt;cmap&gt; can be specified, as well as the</span>
<span class="sd">    color range &lt;clim&gt; in the form (v_min,v_max).</span>
<span class="sd">    &lt;stride&gt; specifies the discretization increment, lower being higher quality.</span>

<span class="sd">    for &lt;kind&gt;=&quot;wire&quot;, the linewidth &lt;lw&gt; and linecolor &lt;lc&gt; can be specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.axes.Axes object containing the plot</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span> <span class="c1"># noqa: F401 unused import</span>

    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">figsize</span><span class="p">:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axis</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clim</span><span class="o">==</span><span class="s2">&quot;auto&quot;</span><span class="p">:</span> <span class="n">clim</span> <span class="o">=</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> 
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span> 
            <span class="n">col</span> <span class="o">=</span> <span class="n">cmap</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">col</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                               <span class="n">rstride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                               <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="n">aa</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span><span class="o">==</span><span class="s2">&quot;wire&quot;</span><span class="p">:</span> 
        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">rstride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
                                 <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lc</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="n">aa</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="c1">#ax.set_box_aspect((np.ptp(X), np.ptp(Y), np.ptp(array)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s2">&quot;color&quot;</span> <span class="ow">and</span> <span class="n">axis</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> 
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span> 
            <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span></div>
    




<span class="c1">#%% ----- Data input / output / manipulation ----- %%#</span>

<div class="viewcode-block" id="readConfig"><a class="viewcode-back" href="../cmutils.html#cmutils.readConfig">[docs]</a><span class="k">def</span> <span class="nf">readConfig</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; read contMech konfig file</span>
<span class="sd">    </span>
<span class="sd">    reads column &lt;usecols&gt; from file &lt;filepath&gt;, and converts it to an (nx,ny)</span>
<span class="sd">    numpy.ndarray, assuming the first line in the file is of the form &quot;#nx ny&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">XLIM</span><span class="p">,</span> <span class="n">YLIM</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
    
    <span class="c1"># Read nx, ny and reshape array accordingly</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="p">):</span><span class="c1"># and (array[0] == array[ny]) ): # additional lines</span>
        <span class="n">lXfac</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="n">nx</span><span class="p">,:</span><span class="n">ny</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">513</span><span class="o">*</span><span class="mi">513</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">array</span><span class="p">[</span><span class="mi">512</span><span class="p">])</span> <span class="p">):</span> <span class="c1"># frames are downsampled to 512x512</span>
        <span class="n">lXfac</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="n">nx</span><span class="p">,:</span><span class="n">ny</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lXfac</span> <span class="o">=</span> <span class="n">nx</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>
    
    <span class="c1"># Update YLIM using first 2 lines</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="p">()</span> <span class="k">as</span> <span class="n">sup</span><span class="p">:</span>
        <span class="n">sup</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">)</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dyH</span> <span class="o">=</span> <span class="p">(</span><span class="n">dummy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dummy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">YLIM</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">dyH</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span> <span class="n">dyH</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>
    
    <span class="c1"># Update XLIM using first and last line</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># 2nd arg = 2 --&gt; relative to EOF</span>
    <span class="k">while</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">fid</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># skip trailing empty lines</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 2nd arg = 1 --&gt; relative to current position</span>
    <span class="k">while</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">fid</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">lineN</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
    <span class="n">lengthX</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lineN</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">lXfac</span>
    <span class="n">XLIM</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">lengthX</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">lengthX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#array = np.rot90(array)</span>

    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Dimens] Updating XLIM and YLIM to fit imported data:&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  lengthX  = &quot;</span><span class="p">,</span> <span class="n">lengthX</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  lengthY  = &quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">dyH</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></div>


 
<div class="viewcode-block" id="readMulti"><a class="viewcode-back" href="../cmutils.html#cmutils.readMulti">[docs]</a><span class="k">def</span> <span class="nf">readMulti</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; read contMech konfig file</span>
<span class="sd">    </span>
<span class="sd">    reads column &lt;usecols&gt; from file &lt;filepath&gt;, and converts it to an (nx,ny)</span>
<span class="sd">    numpy.ndarray, assuming the first line in the file is of the form &quot;#nx ny&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">XLIM</span><span class="p">,</span> <span class="n">YLIM</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()]</span>
    
    <span class="c1"># sanity check on columns</span>
    <span class="n">nCol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">usecols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">usecols</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nCol</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">usecols</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="n">usecols</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">usecols</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="n">nCol</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;column index out of range: </span><span class="si">%i</span><span class="s2">/</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">nCol</span><span class="p">))</span>

    <span class="c1"># data shape and lengthX, lengthY</span>
    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">lengthX</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lengthY</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">ny</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>


    <span class="n">arrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">usecols</span><span class="p">:</span>
        <span class="n">arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">col</span><span class="p">])</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]))</span>

    <span class="c1"># default: reshape the (nx+1)*(ny+1) flat arrays to a (nx, ny) ndarray</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)):</span>
            <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">))[:</span><span class="n">nx</span><span class="p">,:</span><span class="n">ny</span><span class="p">]</span>
    <span class="c1"># frames: might have been downsampled to 512x512</span>
    <span class="k">elif</span> <span class="p">(</span> <span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">513</span><span class="o">*</span><span class="mi">513</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">arrays</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">512</span><span class="p">])</span> <span class="p">):</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)):</span>
            <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">))[:</span><span class="n">nx</span><span class="p">,:</span><span class="n">ny</span><span class="p">]</span>
    <span class="c1"># legacy: cmutils used to export nx*ny flat arrays rather than (nx+1)*(ny+1)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)):</span> <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>
        <span class="n">lengthX</span> <span class="o">=</span> <span class="n">lengthX</span><span class="o">*</span><span class="n">nx</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arrays</span></div>
    


<div class="viewcode-block" id="readImg"><a class="viewcode-back" href="../cmutils.html#cmutils.readImg">[docs]</a><span class="k">def</span> <span class="nf">readImg</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; read image file (without lateral info)</span>
<span class="sd">    </span>
<span class="sd">    reads file &lt;filepath&gt; with ny numbers per line and nx lines into a (nx, ny)</span>
<span class="sd">    numpy.ndarray.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Format] contMech format is upside-down! Use img2config() to compare.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="img2config"><a class="viewcode-back" href="../cmutils.html#cmutils.img2config">[docs]</a><span class="k">def</span> <span class="nf">img2config</span><span class="p">(</span><span class="n">array</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">array</span><span class="p">)</span></div>

<div class="viewcode-block" id="config2img"><a class="viewcode-back" href="../cmutils.html#cmutils.config2img">[docs]</a><span class="k">def</span> <span class="nf">config2img</span><span class="p">(</span><span class="n">array</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="n">array</span><span class="p">)</span></div>


<div class="viewcode-block" id="rot90"><a class="viewcode-back" href="../cmutils.html#cmutils.rot90">[docs]</a><span class="k">def</span> <span class="nf">rot90</span><span class="p">(</span><span class="n">array</span><span class="p">):</span> <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span></div>
<div class="viewcode-block" id="rot180"><a class="viewcode-back" href="../cmutils.html#cmutils.rot180">[docs]</a><span class="k">def</span> <span class="nf">rot180</span><span class="p">(</span><span class="n">array</span><span class="p">):</span> <span class="k">return</span> <span class="n">array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>
<div class="viewcode-block" id="rot270"><a class="viewcode-back" href="../cmutils.html#cmutils.rot270">[docs]</a><span class="k">def</span> <span class="nf">rot270</span><span class="p">(</span><span class="n">array</span><span class="p">):</span> <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">transpose</span><span class="p">()[:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>
<span class="c1"># Li is a 7x7 &quot;image&quot; with &quot;Li&quot; written on it. Used to troubleshoot image transforms</span>
<span class="n">Li</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
<span class="n">Li</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">Li</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># L</span>
<span class="n">Li</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">Li</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># i</span>


<div class="viewcode-block" id="rot90Multi"><a class="viewcode-back" href="../cmutils.html#cmutils.rot90Multi">[docs]</a><span class="k">def</span> <span class="nf">rot90Multi</span><span class="p">(</span><span class="n">arrays</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rot90</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">rot90</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="rot180Multi"><a class="viewcode-back" href="../cmutils.html#cmutils.rot180Multi">[docs]</a><span class="k">def</span> <span class="nf">rot180Multi</span><span class="p">(</span><span class="n">arrays</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rot180</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">rot180</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="rot270Multi"><a class="viewcode-back" href="../cmutils.html#cmutils.rot270Multi">[docs]</a><span class="k">def</span> <span class="nf">rot270Multi</span><span class="p">(</span><span class="n">arrays</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="o">-</span><span class="n">arrays</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)):</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rot270</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">rot270</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="flip"><a class="viewcode-back" href="../cmutils.html#cmutils.flip">[docs]</a><span class="k">def</span> <span class="nf">flip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">direction</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">direction</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">direction</span><span class="o">!=</span><span class="n">axis</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="n">result</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="flipMulti"><a class="viewcode-back" href="../cmutils.html#cmutils.flipMulti">[docs]</a><span class="k">def</span> <span class="nf">flipMulti</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; flips displacements and pressures by rotation around a lateral axis</span>

<span class="sd">    assumes that &lt;arrays&gt; is a tuple containing uz, pz(, uy, py, ux, px) in this </span>
<span class="sd">    order. returns the tuple manipulated as if the simulation was rotated by </span>
<span class="sd">    180° around the x-axis (&lt;axis&gt;=0) or y-axis (&lt;axis&gt;=1).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arrays: tuple/list of np.ndarrays</span>
<span class="sd">        assuming z,y,x ordering, displacement and pressure </span>
<span class="sd">    axis: int (0,1)</span>
<span class="sd">        axis, around which the system is rotated. 0: x-axis, 1: y-axis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    arrays as represented in the flipped coordinate system</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span> 
        <span class="n">idcs_disp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">idcs_press</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span> 
        <span class="n">idcs_disp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">idcs_press</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">idcs_disp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idcs_press</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">arrays</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idcs_disp</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idcs_press</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">][:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span> 
            <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idcs_disp</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        
    <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idcs_disp</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idcs_press</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span> 
            <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idcs_disp</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="resample"><a class="viewcode-back" href="../cmutils.html#cmutils.resample">[docs]</a><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">resol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; resample / change array resolution</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : np.ndarray with shape (nx, ny)</span>
<span class="sd">        array to be resampled</span>
<span class="sd">    resol : float or 2-tuple/list of int</span>
<span class="sd">        either the new target resolution (nx_new, ny_new) or a single float </span>
<span class="sd">        representing the new resolution relative to the original according to</span>
<span class="sd">        (nx_new, ny_new) = (round(&lt;resol&gt;*nx), round(&lt;resol&gt;*ny)).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    resampled numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>

    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Period] Resampling uses Fourier filter, which assumes periodicity.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;              For non-periodic arrays, use bilin_resample() instead.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">resol</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span> <span class="n">newShape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">resol</span><span class="o">*</span><span class="n">iShape</span> <span class="k">for</span> <span class="n">iShape</span> <span class="ow">in</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">newShape</span> <span class="o">=</span> <span class="n">resol</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newShape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ERROR] 1st and 2nd argument must have same number of dimensions.&quot;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newShape</span><span class="p">)):</span> <span class="n">result</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">newShape</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="bilin_resample"><a class="viewcode-back" href="../cmutils.html#cmutils.bilin_resample">[docs]</a><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">bilin_resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; resample / change array resolution through bilinear interpolation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : np.ndarray with shape (nx, ny)</span>
<span class="sd">        array to be resampled</span>
<span class="sd">    resol : 2-tuple/list of int</span>
<span class="sd">        new target resolution (nx_new, ny_new)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    resampled numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nxNew</span> <span class="o">=</span> <span class="n">new_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nyNew</span> <span class="o">=</span> <span class="n">new_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">resolX</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">nxNew</span>
    <span class="n">resolY</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">nyNew</span>
  
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nxNew</span><span class="p">,</span><span class="n">nyNew</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">double</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">resolX</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">resolX</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">resolY</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">resolY</span><span class="p">)):</span>
        <span class="n">xIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nxNew</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">resolX</span>
        <span class="n">xIdx</span> <span class="o">=</span> <span class="n">xIdx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
        <span class="n">yIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nyNew</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">resolY</span>
        <span class="n">yIdx</span> <span class="o">=</span> <span class="n">yIdx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nxNew</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nyNew</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">xIdx</span><span class="p">[</span><span class="n">ix</span><span class="p">]:</span><span class="n">xIdx</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">yIdx</span><span class="p">[</span><span class="n">iy</span><span class="p">]:</span><span class="n">yIdx</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nxNew</span><span class="p">)</span><span class="o">*</span><span class="n">resolX</span>
        <span class="n">yIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nyNew</span><span class="p">)</span><span class="o">*</span><span class="n">resolY</span>
    
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nxNew</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nyNew</span><span class="p">):</span>
                <span class="c1"># neighbors</span>
                <span class="n">xL</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xIdx</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
                <span class="n">xR</span> <span class="o">=</span> <span class="n">xL</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">yB</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yIdx</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span>
                <span class="n">yT</span> <span class="o">=</span> <span class="n">yB</span> <span class="o">+</span> <span class="mi">1</span>
        
                <span class="c1"># weights: bilinear interpolation</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">xIdx</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">xL</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">yIdx</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">-</span> <span class="n">yB</span>
                <span class="n">wTR</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dy</span>
                <span class="n">wTL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span>
                <span class="n">wBR</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span>
                <span class="n">wBL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dy</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">wBL</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="n">xL</span><span class="p">,</span><span class="n">yB</span><span class="p">]</span> <span class="o">+</span> <span class="n">wBR</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="n">xR</span><span class="p">,</span><span class="n">yB</span><span class="p">]</span> <span class="o">+</span> <span class="n">wTL</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="n">xL</span><span class="p">,</span><span class="n">yT</span><span class="p">]</span> <span class="o">+</span> <span class="n">wTR</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="n">xR</span><span class="p">,</span><span class="n">yT</span><span class="p">]</span>
        
                <span class="n">result</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
  
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="reduce"><a class="viewcode-back" href="../cmutils.html#cmutils.reduce">[docs]</a><span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">resol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; resample / change array resolution</span>

<span class="sd">    resamples the (nx,ny) numpy.ndarray &lt;array&gt; to the new resolution &lt;resol&gt;.</span>
<span class="sd">    &lt;resol&gt; can be of form (nx_new, ny_new) or a single int, </span>
<span class="sd">    which is translated to &lt;resol&gt; = (round(nx/&lt;resol&gt;), round(ny/&lt;resol&gt;)).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    resampled numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Deprec] reduce() is deprecated and will be removed in a future release. Use bilin_resample() instead.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">resol</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
        <span class="n">nxNew</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">resol</span><span class="p">)</span>
        <span class="n">nyNew</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">resol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="n">nxNew</span><span class="p">,</span><span class="n">nyNew</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nxNew</span><span class="p">,</span> <span class="n">nyNew</span> <span class="o">=</span> <span class="n">resol</span>
        <span class="k">return</span> <span class="n">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="n">nxNew</span><span class="p">,</span><span class="n">nyNew</span><span class="p">))</span></div>


<div class="viewcode-block" id="slopeX"><a class="viewcode-back" href="../cmutils.html#cmutils.slopeX">[docs]</a><span class="k">def</span> <span class="nf">slopeX</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="n">array</span><span class="p">[:</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">(</span> <span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">array</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span></div>

<div class="viewcode-block" id="slopeY"><a class="viewcode-back" href="../cmutils.html#cmutils.slopeY">[docs]</a><span class="k">def</span> <span class="nf">slopeY</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="n">array</span><span class="p">[:,:</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="n">array</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">(</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span></div>


<div class="viewcode-block" id="corners"><a class="viewcode-back" href="../cmutils.html#cmutils.corners">[docs]</a><span class="k">def</span> <span class="nf">corners</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; meeting point of &lt;array&gt;&#39;s corners</span>

<span class="sd">    constructs the 2&lt;N&gt; x 2&lt;N&gt; area around the point where the four corners meet </span>
<span class="sd">    if np.ndarray &lt;array&gt; is periodically repeated in the plane.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">))</span>
    <span class="n">result</span><span class="p">[:</span><span class="n">N</span><span class="p">,:</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="n">N</span><span class="p">:,</span><span class="o">-</span><span class="n">N</span><span class="p">:]</span>
    <span class="n">result</span><span class="p">[</span><span class="n">N</span><span class="p">:,</span><span class="n">N</span><span class="p">:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="n">N</span><span class="p">,:</span><span class="n">N</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="n">N</span><span class="p">:,:</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="n">N</span><span class="p">,</span><span class="o">-</span><span class="n">N</span><span class="p">:]</span>
    <span class="n">result</span><span class="p">[:</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="n">N</span><span class="p">:,:</span><span class="n">N</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="smoothPBC"><a class="viewcode-back" href="../cmutils.html#cmutils.smoothPBC">[docs]</a><span class="k">def</span> <span class="nf">smoothPBC</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">overlapX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overlapY</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; make non-periodic image smooth at periodic boundaries</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : np.ndarray</span>
<span class="sd">        array whose edges are manipulated</span>
<span class="sd">    overlapX : int or None</span>
<span class="sd">        all points within &lt;overlapX&gt; from the edges of &lt;array&gt; along </span>
<span class="sd">        axis 0 are gradually approach the value of the opposite edge.</span>
<span class="sd">    overlapY : int or None</span>
<span class="sd">        all points within &lt;overlapY&gt; from the edges of &lt;array&gt; along </span>
<span class="sd">        axis 1 are gradually approach the value of the opposite edge.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">overlapX</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">overlapX</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">//</span><span class="mi">16</span>
    <span class="k">if</span> <span class="n">overlapY</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">overlapY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">//</span><span class="mi">16</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># array axis 0: use original edges </span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlapX</span><span class="p">):</span>
        <span class="n">wt_idx</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">-</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">idx</span><span class="o">/</span><span class="n">overlapX</span><span class="p">)</span>
        <span class="n">wt_edge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">wt_idx</span>
        <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">wt_idx</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">wt_edge</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),:]</span> <span class="o">=</span> <span class="n">wt_idx</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),:]</span> <span class="o">+</span> <span class="n">wt_edge</span><span class="o">*</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>

    <span class="c1"># array axis 1: use current edges</span>
    <span class="n">edge0</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">edge1</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">overlapY</span><span class="p">):</span>
        <span class="n">wt_idx</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">-</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">idx</span><span class="o">/</span><span class="n">overlapY</span><span class="p">)</span>
        <span class="n">wt_edge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">wt_idx</span>
        <span class="n">result</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">wt_idx</span><span class="o">*</span><span class="n">result</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">wt_edge</span><span class="o">*</span><span class="n">edge1</span>
        <span class="n">result</span><span class="p">[:,</span><span class="o">-</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">wt_idx</span><span class="o">*</span><span class="n">result</span><span class="p">[:,</span><span class="o">-</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="n">wt_edge</span><span class="o">*</span><span class="n">edge0</span>

    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="dumpConfig"><a class="viewcode-back" href="../cmutils.html#cmutils.dumpConfig">[docs]</a><span class="k">def</span> <span class="nf">dumpConfig</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;konfig0py.real&quot;</span><span class="p">,</span> <span class="n">Lx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Ly</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; dump arrays as contMech konfig</span>

<span class="sd">    writes list &lt;arrays&gt; of numpy.ndarrays to a file in the typical format </span>
<span class="sd">    that can be plotted in gnuplot or imported into a contMech simulation.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span> <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrays</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Format] for imported microscope images, use img2config() first.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span><span class="o">=</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="c1">#array.shape</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Lx</span><span class="p">:</span> <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">nx</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">/</span><span class="n">nx</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Ly</span><span class="p">:</span> <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">ny</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">/</span><span class="n">ny</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#</span><span class="si">%i</span><span class="se">\t</span><span class="si">%i</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>
    <span class="c1">#for ix in tqdm(range(nx)): # tqdm 3rdPartyModule</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">FMT</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">FMT</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ix</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">iy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">FMT</span><span class="p">)</span> <span class="o">%</span> <span class="n">array</span><span class="p">[</span><span class="n">ix</span><span class="o">%</span><span class="n">nx</span><span class="p">,</span><span class="n">iy</span><span class="o">%</span><span class="n">ny</span><span class="p">]</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="c1">#out.write( (FMT+&quot;\t&quot;+FMT+&quot;\t&quot;+FMT+&quot;\n&quot;) % (ix*dx, iy*dy, array[ix%nx,iy%ny]) )</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># divider for gnuplot</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="dumpImg"><a class="viewcode-back" href="../cmutils.html#cmutils.dumpImg">[docs]</a><span class="k">def</span> <span class="nf">dumpImg</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; dump array as image text file</span>

<span class="sd">    writes 2D (nx, ny) numpy.ndarray &lt;array&gt; to a text file with ny values per</span>
<span class="sd">    line and nx lines.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="c1">#for ix in tqdm(range(array.shape[0])): # tqdm 3rdPartyModule</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">(</span><span class="n">FMT</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">(</span><span class="n">FMT</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="dumpLines"><a class="viewcode-back" href="../cmutils.html#cmutils.dumpLines">[docs]</a><span class="k">def</span> <span class="nf">dumpLines</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Dump line scan(s)</span>
<span class="sd">    </span>
<span class="sd">    exports individual lines along dimension &lt;dim&gt; from 2D numpy.ndarray &lt;array&gt; </span>
<span class="sd">    into &lt;filename&gt;. </span>
<span class="sd">    &lt;lines&gt; can be an int or a list/tuple of ints with desired line indices to</span>
<span class="sd">    be exported.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">lines</span><span class="p">,:]</span>
        <span class="c1">#print(z.shape)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span><span class="s2">&quot;X&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span><span class="n">lines</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="c1">#print(z.shape)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;lineScans</span><span class="si">%i</span><span class="s2">.dat&quot;</span><span class="o">%</span><span class="n">dim</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">iLine</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Z(&quot;</span><span class="o">+</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iLine</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">(</span><span class="n">FMT</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">zVal</span> <span class="ow">in</span> <span class="n">z</span><span class="p">[:,</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">FMT</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">zVal</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    

<div class="viewcode-block" id="circularMask"><a class="viewcode-back" href="../cmutils.html#cmutils.circularMask">[docs]</a><span class="k">def</span> <span class="nf">circularMask</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rMin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># use the middle of the image</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">rMax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># use the smallest distance between the center and edges</span>
        <span class="n">rMax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">w</span><span class="o">-</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="o">-</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[:</span><span class="n">h</span><span class="p">,</span> <span class="p">:</span><span class="n">w</span><span class="p">]</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">rMin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">dist2</span> <span class="o">&lt;=</span> <span class="n">rMax</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">dist2</span> <span class="o">&lt;=</span> <span class="n">rMax</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">dist2</span> <span class="o">&gt;=</span> <span class="n">rMin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span></div>


<div class="viewcode-block" id="XY"><a class="viewcode-back" href="../cmutils.html#cmutils.XY">[docs]</a><span class="k">def</span> <span class="nf">XY</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">y</span><span class="p">,(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="center"><a class="viewcode-back" href="../cmutils.html#cmutils.center">[docs]</a><span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">XY</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">xCOM</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">norm</span>
    <span class="n">yCOM</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">norm</span>
    <span class="k">return</span><span class="p">((</span><span class="n">xCOM</span><span class="p">,</span><span class="n">yCOM</span><span class="p">))</span></div>

<div class="viewcode-block" id="untilt"><a class="viewcode-back" href="../cmutils.html#cmutils.untilt">[docs]</a><span class="k">def</span> <span class="nf">untilt</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; subtract the tilt from a 2D surface</span>

<span class="sd">    subtract the macroscopic tilt from np.ndarray &lt;array&gt;, assuming it to be </span>
<span class="sd">    linear in both directions.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    the untilted numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nx</span><span class="p">,</span><span class="n">ny</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">nmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">avg</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">nmin</span><span class="o">//</span><span class="mi">32</span>
    <span class="k">if</span> <span class="n">avg</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">avg</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[:</span><span class="n">nx</span><span class="p">,</span> <span class="p">:</span><span class="n">ny</span><span class="p">]</span>
    <span class="n">tl</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="n">avg</span><span class="p">,:</span><span class="n">avg</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:</span><span class="n">avg</span><span class="p">,</span><span class="o">-</span><span class="n">avg</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="n">avg</span><span class="p">:,:</span><span class="n">avg</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="n">avg</span><span class="p">:,</span><span class="o">-</span><span class="n">avg</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">slopeX</span> <span class="o">=</span> <span class="p">(</span><span class="n">bl</span><span class="o">-</span><span class="n">tl</span> <span class="o">+</span> <span class="n">br</span><span class="o">-</span><span class="n">tr</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">slopeY</span> <span class="o">=</span> <span class="p">(</span><span class="n">tr</span><span class="o">-</span><span class="n">tl</span> <span class="o">+</span> <span class="n">br</span><span class="o">-</span><span class="n">bl</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="n">slopeX</span><span class="o">/</span><span class="n">nx</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="n">slopeY</span><span class="o">/</span><span class="n">ny</span>
    <span class="k">return</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">X</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ra"><a class="viewcode-back" href="../cmutils.html#cmutils.Ra">[docs]</a><span class="k">def</span> <span class="nf">Ra</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">h_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span><span class="o">-</span><span class="n">h_mean</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></div>

<div class="viewcode-block" id="Rt"><a class="viewcode-back" href="../cmutils.html#cmutils.Rt">[docs]</a><span class="k">def</span> <span class="nf">Rt</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> 
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">D</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nxH</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">nxH</span><span class="p">,:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">array</span><span class="p">[</span><span class="n">nxH</span><span class="p">,:]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span></div>

<div class="viewcode-block" id="Rz"><a class="viewcode-back" href="../cmutils.html#cmutils.Rz">[docs]</a><span class="k">def</span> <span class="nf">Rz</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;deprecated&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">norm</span><span class="o">!=</span><span class="s2">&quot;deprecated&quot;</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:norm] norm is deprecated.&quot;</span><span class="p">)</span>
 
    <span class="n">dn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">//</span><span class="n">N</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">D</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">array</span><span class="p">[(</span><span class="n">i</span><span class="o">*</span><span class="n">dn</span><span class="p">):(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dn</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">part</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">dn</span><span class="p">,:]</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">part</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">part</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">/</span><span class="n">N</span></div>


<div class="viewcode-block" id="psd1D"><a class="viewcode-back" href="../cmutils.html#cmutils.psd1D">[docs]</a><span class="k">def</span> <span class="nf">psd1D</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># for 2D arrays, determine along which axis to calculate the PSD</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
            <span class="n">nReal</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nFour</span> <span class="o">=</span> <span class="n">nReal</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">arrayF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFour</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">f_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span><span class="n">iy</span><span class="p">])</span>
                <span class="n">arrayF</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">f_height</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">f_height</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">arrayF</span> <span class="o">/=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">nReal</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nFour</span> <span class="o">=</span> <span class="n">nReal</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">arrayF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nFour</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">f_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">ix</span><span class="p">,:])</span>
                <span class="n">arrayF</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">f_height</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">f_height</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">arrayF</span> <span class="o">/=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">arrayF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">f_height</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">f_height</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
        <span class="n">nReal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">nFour</span> <span class="o">=</span> <span class="n">nReal</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># determine q values</span>
    <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nFour</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">L</span>

    <span class="c1"># normalization: Tevis D B Jacobs et al 2017 Surf. Topogr.: Metrol. Prop. 5 013001</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nFour</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">result</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
    <span class="n">result</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrayF</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="n">nReal</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># output to file</span>
    <span class="k">if</span> <span class="n">output</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">dim</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;q</span><span class="se">\t</span><span class="s2">PSD(1D)(q_x)&quot;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;q</span><span class="se">\t</span><span class="s2">PSD(1D)(q_y)&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.5e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="psd"><a class="viewcode-back" href="../cmutils.html#cmutils.psd">[docs]</a><span class="k">def</span> <span class="nf">psd</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; compute Power Spectral Density (PSD) of an array</span>
<span class="sd">    </span>
<span class="sd">    calculates the PSD of numpy.ndarray &lt;array&gt; with auto quasi-log q space.</span>
<span class="sd">    writes the PSD to file &lt;output&gt; if given.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray with 2 columns containing q and C(q) values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Dimens] Assuming dx=dy and ny&lt;=nx.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Period] psd() uses FFT, which assumes periodicity.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">arrayF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft2</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">nxF</span> <span class="o">=</span> <span class="n">arrayF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">nyF</span> <span class="o">=</span> <span class="n">arrayF</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># quasi-log indices</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nyF</span><span class="o">-</span><span class="n">nyF</span><span class="o">//</span><span class="mi">8</span><span class="p">),</span> <span class="n">nyF</span><span class="o">//</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nyF</span><span class="o">//</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">result</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    
    <span class="c1"># average PSD over rings of approximately equal |q|</span>
    <span class="n">abs2F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">arrayF</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">arrayF</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">rMax</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">ir</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span> <span class="n">rMin</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">nyF</span><span class="p">,</span> <span class="n">nxF</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rMax</span><span class="p">,</span> <span class="n">rMin</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">nyF</span><span class="p">,</span> <span class="n">nxF</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nxF</span><span class="p">),</span> <span class="n">rMax</span><span class="p">,</span> <span class="n">rMin</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">abs2F</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

    <span class="c1"># normalization: Tevis D B Jacobs et al 2017 Surf. Topogr.: Metrol. Prop. 5 013001</span>
    <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">nxny</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">area</span><span class="o">/</span><span class="p">(</span><span class="n">nxny</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.5e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;q</span><span class="se">\t</span><span class="s2">PSD(2D-iso)(q)&quot;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="plotPSD"><a class="viewcode-back" href="../cmutils.html#cmutils.plotPSD">[docs]</a><span class="k">def</span> <span class="nf">plotPSD</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; plot PSD of array</span>
<span class="sd">    </span>
<span class="sd">    plots the PSD of numpy.ndarray &lt;array&gt;.</span>
<span class="sd">    &lt;axis&gt;, the matplotlib.axes.Axes object on which to plot, can be specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.axes.Axes object containing the plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">psdData</span> <span class="o">=</span> <span class="n">psd</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">axis</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;PSD&quot;</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">psdData</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">psdData</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span></div>


<div class="viewcode-block" id="createBorder"><a class="viewcode-back" href="../cmutils.html#cmutils.createBorder">[docs]</a><span class="k">def</span> <span class="nf">createBorder</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">nxNew</span><span class="p">,</span> <span class="n">nyNew</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; create border around surface </span>

<span class="sd">    generates a (&lt;nxNew&gt;, &lt;nyNew&gt;) numpy.ndarray that contains the (nx, ny) </span>
<span class="sd">    numpy.ndarray &lt;array&gt;.</span>
<span class="sd">    &lt;nxNew&gt; must be larger than nx and &lt;nyNew&gt; larger than ny.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    the new numpy.ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="p">(</span><span class="n">nxOld</span><span class="p">,</span><span class="n">nyOld</span><span class="p">)</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Border] createBorder() assumes array to be in equilPos format.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nxNew</span> <span class="o">&lt;</span> <span class="n">nxOld</span> <span class="ow">or</span> <span class="n">nyNew</span> <span class="o">&lt;</span> <span class="n">nyOld</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ERROR] surface larger than bordered surface!&quot;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">nxStart</span> <span class="o">=</span> <span class="p">(</span><span class="n">nxNew</span><span class="o">-</span><span class="n">nxOld</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nxStart</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nxStart</span><span class="p">))</span> <span class="ow">and</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Border] nxNew-nxOld is not a multiple of 2.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nxStart</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nxStart</span><span class="p">)</span>
    <span class="n">nyStart</span> <span class="o">=</span> <span class="p">(</span><span class="n">nyNew</span><span class="o">-</span><span class="n">nyOld</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nyStart</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nyStart</span><span class="p">))</span> <span class="ow">and</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Warn:Border] nyNew-nyOld is not a multiple of 2.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nyStart</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nyStart</span><span class="p">)</span>
    <span class="n">nxEnd</span> <span class="o">=</span> <span class="n">nxStart</span> <span class="o">+</span> <span class="n">nxOld</span>
    <span class="n">nyEnd</span> <span class="o">=</span> <span class="n">nyStart</span> <span class="o">+</span> <span class="n">nyOld</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nxNew</span><span class="p">,</span><span class="n">nyNew</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="n">nxStart</span><span class="p">:</span><span class="n">nxEnd</span><span class="p">,</span><span class="n">nyStart</span><span class="p">:</span><span class="n">nyEnd</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span>
    <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>





<span class="c1">#%% ----- Other: mostly for legacy contMech versions ----- %%#</span>
    
<div class="viewcode-block" id="logsmooth"><a class="viewcode-back" href="../cmutils.html#cmutils.logsmooth">[docs]</a><span class="k">def</span> <span class="nf">logsmooth</span><span class="p">(</span><span class="n">infilename</span><span class="p">,</span> <span class="n">outfilename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">outfilename</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">outfilename</span> <span class="o">=</span> <span class="n">infilename</span> <span class="o">+</span> <span class="s2">&quot;-log&quot;</span>
    <span class="n">psd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">infilename</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfilename</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">psd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># logarithmically spaced bin edges for equally spaced log plot</span>
    <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.001</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">nbin</span><span class="p">)</span>
    <span class="n">binedge</span> <span class="o">=</span> <span class="mf">0.999</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="c1"># linearly spaced bin edges</span>
    <span class="c1">#counts,binedge = np.histogram(q,nbin)</span>
    <span class="n">qval</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">binedge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nbin</span><span class="p">]</span> <span class="o">+</span> <span class="n">binedge</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">nbin</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nbin</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">usecols</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ibin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nbin</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">q</span><span class="o">&gt;</span><span class="n">binedge</span><span class="p">[</span><span class="n">ibin</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">q</span><span class="o">&lt;</span><span class="n">binedge</span><span class="p">[</span><span class="n">ibin</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">iCol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">usecols</span><span class="p">)):</span>
                <span class="n">spec</span><span class="p">[</span><span class="n">ibin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">iCol</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">psd</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="n">iCol</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">spec</span><span class="p">[</span><span class="n">ibin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.5e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">qval</span><span class="p">[</span><span class="n">ibin</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iCol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">usecols</span><span class="p">)):</span> <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">%.5e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">spec</span><span class="p">[</span><span class="n">ibin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">iCol</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    <span class="c1">#return(spec)</span>


<div class="viewcode-block" id="contStats"><a class="viewcode-back" href="../cmutils.html#cmutils.contStats">[docs]</a><span class="k">def</span> <span class="nf">contStats</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">SHOW</span>
    <span class="k">if</span> <span class="n">filepath</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">readConfig</span><span class="p">(</span><span class="s2">&quot;equilPos0.dat&quot;</span><span class="p">)</span>
    <span class="n">dataElast</span> <span class="o">=</span> <span class="n">readConfig</span><span class="p">(</span><span class="s2">&quot;elSheet1.dat&quot;</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="o">-</span><span class="n">dataElast</span>
    <span class="k">del</span> <span class="n">dataElast</span>
    <span class="c1"># Criterion for being in contact</span>
    <span class="n">incontact</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">incontact</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">contArea</span> <span class="o">=</span> <span class="n">incontact</span><span class="o">.</span><span class="n">mean</span><span class="p">();</span> <span class="n">meanGap</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">dist</span>
    <span class="c1"># Pressure in contact histogram</span>
    <span class="n">pressCont</span> <span class="o">=</span> <span class="n">readConfig</span><span class="p">(</span><span class="s2">&quot;elSheet1.dat&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pressCont</span> <span class="o">=</span> <span class="n">pressCont</span><span class="p">[</span><span class="n">incontact</span><span class="p">]</span>
    <span class="n">pCounts</span><span class="p">,</span><span class="n">binedge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">pressCont</span><span class="p">,</span><span class="n">nbin</span><span class="p">)</span>
    <span class="n">pVal</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">binedge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nbin</span><span class="p">]</span> <span class="o">+</span> <span class="n">binedge</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">nbin</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">pMean</span> <span class="o">=</span> <span class="n">pressCont</span><span class="o">.</span><span class="n">mean</span><span class="p">();</span> <span class="n">pStd</span> <span class="o">=</span> <span class="n">pressCont</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="c1"># Print</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pressure in cont.: </span><span class="si">%.5e</span><span class="s2"> +/- </span><span class="si">%.5e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pMean</span><span class="p">,</span> <span class="n">pStd</span><span class="p">)</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rel. contact area: </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">contArea</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean gap:          </span><span class="si">%.5e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">meanGap</span><span class="p">)</span>
    <span class="c1"># Dump</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;params.out&quot;</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">0</span><span class="se">\t</span><span class="s2"># PYTHON post-analysis start</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.5e</span><span class="se">\t\t</span><span class="s2"># mean pressure in contact</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pMean</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.5e</span><span class="se">\t\t</span><span class="s2"># std of pressure in contact</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pStd</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="se">\t\t</span><span class="s2"># rel. contact area</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">contArea</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.5e</span><span class="se">\t\t</span><span class="s2"># mean gap</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">meanGap</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0</span><span class="se">\t</span><span class="s2"># PYTHON post-analysis end</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Plot</span>
    <span class="n">show_orig</span> <span class="o">=</span> <span class="n">SHOW</span>
    <span class="n">SHOW</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">plotImg</span><span class="p">(</span><span class="n">incontact</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;pressure in contact&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;probability&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pVal</span><span class="p">,</span><span class="n">pCounts</span><span class="o">/</span><span class="n">pressCont</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">SHOW</span> <span class="o">=</span> <span class="n">show_orig</span>
    <span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="int1D"><a class="viewcode-back" href="../cmutils.html#cmutils.int1D">[docs]</a><span class="k">def</span> <span class="nf">int1D</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span><span class="n">xcol</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:,</span><span class="n">ycol</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="flatPunch"><a class="viewcode-back" href="../cmutils.html#cmutils.flatPunch">[docs]</a><span class="k">def</span> <span class="nf">flatPunch</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">piston</span> <span class="o">=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
    <span class="n">piston</span> <span class="o">=</span> <span class="n">piston</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">piston</span> <span class="o">=</span> <span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">piston</span> <span class="o">+</span> <span class="n">h</span>
    <span class="k">if</span> <span class="n">WARN</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Info:Format] faltPunch() returns array in equilPos format.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">piston</span><span class="p">)</span></div>



<span class="c1">#%% ----- Interaction parameters for legacy contMech versions ----- %%#</span>

<span class="n">GAMMA</span> <span class="o">=</span> <span class="mf">50e-3</span>   <span class="c1"># surface energy in SI base units</span>
<span class="n">E</span> <span class="o">=</span> <span class="mf">2.7e6</span>       <span class="c1"># contact modulus for PDMS in SI base units</span>
<div class="viewcode-block" id="curvEla"><a class="viewcode-back" href="../cmutils.html#cmutils.curvEla">[docs]</a><span class="k">def</span> <span class="nf">curvEla</span><span class="p">(</span><span class="n">dy</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># max elast. curv for 1D surface, qMax = pi/dy</span></div>
<div class="viewcode-block" id="curvEla2D"><a class="viewcode-back" href="../cmutils.html#cmutils.curvEla2D">[docs]</a><span class="k">def</span> <span class="nf">curvEla2D</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">E</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>
<div class="viewcode-block" id="curvMorse1"><a class="viewcode-back" href="../cmutils.html#cmutils.curvMorse1">[docs]</a><span class="k">def</span> <span class="nf">curvMorse1</span><span class="p">(</span><span class="n">sigMorse</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="n">sigMorse</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
<div class="viewcode-block" id="curvMorse2"><a class="viewcode-back" href="../cmutils.html#cmutils.curvMorse2">[docs]</a><span class="k">def</span> <span class="nf">curvMorse2</span><span class="p">(</span><span class="n">sigMorse</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sigMorse</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
<div class="viewcode-block" id="curvCos1"><a class="viewcode-back" href="../cmutils.html#cmutils.curvCos1">[docs]</a><span class="k">def</span> <span class="nf">curvCos1</span><span class="p">(</span><span class="n">sigCosine</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">sigCosine</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
<div class="viewcode-block" id="curvCos2"><a class="viewcode-back" href="../cmutils.html#cmutils.curvCos2">[docs]</a><span class="k">def</span> <span class="nf">curvCos2</span><span class="p">(</span><span class="n">sigCosine</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigCosine</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
<div class="viewcode-block" id="uMorse1"><a class="viewcode-back" href="../cmutils.html#cmutils.uMorse1">[docs]</a><span class="k">def</span> <span class="nf">uMorse1</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">sigMorse</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">curvMorse1</span><span class="p">(</span><span class="n">sigMorse</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="n">E</span><span class="p">))</span> <span class="c1"># µ_rho for Morse1</span></div>
<div class="viewcode-block" id="uMorse2"><a class="viewcode-back" href="../cmutils.html#cmutils.uMorse2">[docs]</a><span class="k">def</span> <span class="nf">uMorse2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">sigMorse</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">curvMorse2</span><span class="p">(</span><span class="n">sigMorse</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="n">E</span><span class="p">))</span> <span class="c1"># µ_rho for Morse2</span></div>
<div class="viewcode-block" id="uCos1"><a class="viewcode-back" href="../cmutils.html#cmutils.uCos1">[docs]</a><span class="k">def</span> <span class="nf">uCos1</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">sigCosine</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">curvCos1</span><span class="p">(</span><span class="n">sigCosine</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="n">E</span><span class="p">))</span> <span class="c1"># µ_rho for Cosine1</span></div>
<div class="viewcode-block" id="uCos2"><a class="viewcode-back" href="../cmutils.html#cmutils.uCos2">[docs]</a><span class="k">def</span> <span class="nf">uCos2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">sigCosine</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">curvCos2</span><span class="p">(</span><span class="n">sigCosine</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="n">E</span><span class="p">))</span> <span class="c1"># µ_rho for Cosine2</span></div>
<div class="viewcode-block" id="sigMorse1"><a class="viewcode-back" href="../cmutils.html#cmutils.sigMorse1">[docs]</a><span class="k">def</span> <span class="nf">sigMorse1</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">uRho</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="n">uRho</span><span class="p">)</span></div>
<div class="viewcode-block" id="sigMorse2"><a class="viewcode-back" href="../cmutils.html#cmutils.sigMorse2">[docs]</a><span class="k">def</span> <span class="nf">sigMorse2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">uRho</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">uRho</span><span class="p">))</span></div>
<div class="viewcode-block" id="sigCos1"><a class="viewcode-back" href="../cmutils.html#cmutils.sigCos1">[docs]</a><span class="k">def</span> <span class="nf">sigCos1</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">uRho</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">E</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">uRho</span><span class="p">)</span></div>
<div class="viewcode-block" id="sigCos2"><a class="viewcode-back" href="../cmutils.html#cmutils.sigCos2">[docs]</a><span class="k">def</span> <span class="nf">sigCos2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">uRho</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">dy</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">E</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">uRho</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Christian Mueller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>