

<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cmanim &#8212; cmutils 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css?v=f9ae72be" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">cmutils 0.0.1 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cmanim</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cmanim</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-------------------------------------</span>
<span class="sd">  Animation of contMech Simulations</span>
<span class="sd">-------------------------------------</span>

<span class="sd">An easy-to-use library for animating simulation results.</span>
<span class="sd">The focus is on fully automatic usage, where the best possible parameters are read from params.out. </span>


<span class="sd">------------</span>
<span class="sd">  Examples</span>
<span class="sd">------------</span>

<span class="sd">Example to create and save a contact movie:  </span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    import cmanim</span>

<span class="sd">    animation = cmanim.runCont2D()</span>
<span class="sd">    cmanim.save(animation, &quot;movie.gif&quot;)</span>

<span class="sd">Specifying custom parameters is possible by calling individual initialization functions one after the other. </span>
<span class="sd">E.g. you can animate the cross-sections along x-direction from two different simulations in one figure, limit it to frames 40 to 100, and zoom in to a certain xrange:  </span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    cmanim.init(&quot;DispX&quot;, [path1, path2] )</span>
<span class="sd">    cmanim.XLIM = [xmin, xmax]</span>
<span class="sd">    cmanim.START = 40</span>
<span class="sd">    cmanim.END = 100</span>
<span class="sd">    cmanim.NFRAMES = 60</span>
<span class="sd">    animation = cmanim.run()</span>

<span class="sd">Essentially, the previously mentioned `runCont2D()` is just a wrapper for `cmanim.init(&quot;Cont2D&quot;,paths=&quot;.&quot;); cmanim.run()`, where `init(...)` automatically determines plot parameters, which you can (but most of the time don&#39;t need to) overwrite.  </span>


<span class="sd">---------------------</span>
<span class="sd">  API documentation</span>
<span class="sd">---------------------</span>
<span class="sd">&quot;&quot;&quot;</span>



<span class="c1">#%% ----- Global settings ----- %%#</span>

<span class="c1"># For testing</span>
<span class="n">testpath</span> <span class="o">=</span> <span class="s2">&quot;/home/chris/src8fix/run2&quot;</span>

<span class="c1"># Input</span>
<span class="n">SHOW</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">DPI</span> <span class="o">=</span> <span class="mi">180</span>
<span class="n">LINESTYLE</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
<span class="n">MARKERSTYLE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">MODE</span> <span class="o">=</span> <span class="s2">&quot;DispX&quot;</span>
<span class="n">VERSION</span> <span class="o">=</span> <span class="s2">&quot;new&quot;</span> <span class="c1"># &quot;new&quot; or &quot;dev&quot;</span>
<span class="n">UNITS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;arb. u.&quot;</span><span class="p">,</span><span class="s2">&quot;arb. u.&quot;</span><span class="p">]</span>

<span class="c1"># Data parameters</span>
<span class="n">NX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">NY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">XLIM</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">YLIM</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ZLIM</span> <span class="o">=</span> <span class="p">[</span><span class="o">+</span><span class="mf">1.0e+38</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0e+38</span><span class="p">]</span>
<span class="n">RESMOVIE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">XRAMP</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="n">YRAMP</span> <span class="o">=</span> <span class="kc">None</span> 
<span class="n">INCREMENT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">NFRAMES</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">START</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">END</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">SHEET</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">INTER</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">LABELS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">RAMP</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">GRID</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">IID</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># TODO: now always plots inter class with ID 0. Generalize this.</span>

<span class="n">fATTRACT</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># TODO: read this in?</span>

<span class="c1"># Add another arbitrary ramp file to be plotted</span>
<span class="n">ADDRAMP</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;plot&quot;</span>   <span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">&quot;x&quot;</span>      <span class="p">:</span> <span class="p">[],</span>
           <span class="s2">&quot;y&quot;</span>      <span class="p">:</span> <span class="p">[],</span>
           <span class="s2">&quot;ls&quot;</span>     <span class="p">:</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span>
           <span class="s2">&quot;lab&quot;</span>    <span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>




<span class="c1">#%% ----- Class and function definitions ----- %%#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="kn">import</span> <span class="nn">cmutils</span> <span class="k">as</span> <span class="nn">cm</span>


<div class="viewcode-block" id="gfmdSheet">
<a class="viewcode-back" href="../cmanim.html#cmanim.gfmdSheet">[docs]</a>
<span class="k">class</span> <span class="nc">gfmdSheet</span><span class="p">:</span>
    <span class="c1"># Defaults: should match contMech code</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">lengthX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">lengthY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fRough</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nElast</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">fKelvinVoigt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stiffness0</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">f3dMovie</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># compatibility parameters to join multiple paths</span>
    <span class="n">nTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nFrames</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">increment</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># Ramp / vz</span>
    <span class="n">vzConstCOM</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dTime</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fSteppedRamp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dzRamp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">rampPeriod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nVeloTurnStep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">rampName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;konfig&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># file names</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">minmaxZ</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newID</span><span class="p">):</span> 
        <span class="k">global</span> <span class="n">INCREMENT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">newID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="o">=</span> <span class="n">INCREMENT</span>
    
<div class="viewcode-block" id="gfmdSheet.updateNxNy">
<a class="viewcode-back" href="../cmanim.html#cmanim.gfmdSheet.updateNxNy">[docs]</a>
    <span class="k">def</span> <span class="nf">updateNxNy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">NX</span><span class="p">,</span> <span class="n">NY</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">NX</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">NY</span></div>


<div class="viewcode-block" id="gfmdSheet.updateFiles">
<a class="viewcode-back" href="../cmanim.html#cmanim.gfmdSheet.updateFiles">[docs]</a>
    <span class="k">def</span> <span class="nf">updateFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span><span class="c1">#, numFrames):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; sets up list of frame files belonging to this object &quot;&quot;&quot;</span>

        <span class="k">global</span> <span class="n">NFRAMES</span>
        
        <span class="c1"># konfigName</span>
        <span class="k">if</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span> <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;.dat&quot;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;.datH&quot;</span>
        <span class="k">if</span> <span class="n">VERSION</span> <span class="o">==</span> <span class="s2">&quot;new&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;konfig&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fRough</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">+=</span> <span class="s2">&quot;E&quot;</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;frames/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">+</span> <span class="s2">&quot;D&quot;</span>
        <span class="k">elif</span> <span class="n">VERSION</span> <span class="o">==</span> <span class="s2">&quot;dev&quot;</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;movie/elSheet&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;equilPos&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
        
        <span class="c1"># Individual profile file names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">+</span> <span class="n">ending</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s2">&quot;does not exist.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iFrame</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">iFrame</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iFrame</span><span class="p">)</span> <span class="o">+</span> <span class="n">ending</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">)):</span> <span class="k">break</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iFrame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s2">&quot;does not exist.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nTime</span><span class="o">*</span><span class="p">(</span><span class="n">iFrame</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span> <span class="o">=</span> <span class="n">iFrame</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="c1"># Ramp file name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fSteppedRamp</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;ramp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rampName</span> <span class="o">=</span> <span class="n">file</span>
                <span class="c1">#print(&quot;ramp period:&quot;, self.rampPeriod)</span>
            <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s2">&quot;not found.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vzConstCOM</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;moni&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rampName</span> <span class="o">=</span> <span class="n">file</span>
                <span class="c1">#TODO: check if working</span>
            <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s2">&quot;not found.&quot;</span><span class="p">)</span>

        <span class="c1"># Sanity check</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] No files found for sheet &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="gfmdSheet.updateCols">
<a class="viewcode-back" href="../cmanim.html#cmanim.gfmdSheet.updateCols">[docs]</a>
    <span class="k">def</span> <span class="nf">updateCols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; determines which columns in the data files must be imported &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;DispX&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;DispY&quot;</span><span class="p">)):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;DispY&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;DispD&quot;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;PressX&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">MODE</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PressX&quot;</span><span class="p">,</span><span class="s2">&quot;PressY&quot;</span><span class="p">]):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;PressY&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">MODE</span> <span class="o">==</span> <span class="s2">&quot;PressD&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Dist3D&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Cont3D&quot;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Disp3D&quot;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Press3D&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] sheet[&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;] cannot update cols according to MODE.&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="gfmdSheet.updateData">
<a class="viewcode-back" href="../cmanim.html#cmanim.gfmdSheet.updateData">[docs]</a>
    <span class="k">def</span> <span class="nf">updateData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">numFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; reads and sets up the data file needed to plot the next frame &quot;&quot;&quot;</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">START</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="o">*</span><span class="p">(</span><span class="n">numFrame</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">START</span><span class="p">)</span> <span class="c1"># numFrame starts at 1, not 0!</span>
        
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] no further frames found for sheet&quot;</span><span class="p">)</span>
            <span class="k">return</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span>
            <span class="c1">#import cmutils as cm</span>
            <span class="n">cm</span><span class="o">.</span><span class="n">WARN</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">readConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usecols</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># rigid sheet only updates once</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">readConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usecols</span><span class="p">)</span>
            <span class="c1"># TODO: What if elast sheet was downsampled to be smaller than 512x512?</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="o">!=</span><span class="n">NX</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="o">!=</span><span class="n">NY</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="o">&gt;</span><span class="mi">512</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="o">&gt;</span><span class="mi">512</span><span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,(</span><span class="n">NX</span><span class="p">,</span><span class="n">NY</span><span class="p">))</span>
            <span class="c1">#WIP</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="c1">#print(numFrame,&quot;elast sheet&quot;,self.ID,&quot;after: &quot;, self.data.shape)#DEBUG</span>

        <span class="k">else</span><span class="p">:</span> 
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usecols</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Konfig file #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numFrame</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; not found&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;µ&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mm&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># rigid sheet only updates once</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">usecols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usecols</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;µ&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mm&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

                
    
<div class="viewcode-block" id="gfmdSheet.updateDims">
<a class="viewcode-back" href="../cmanim.html#cmanim.gfmdSheet.updateDims">[docs]</a>
    <span class="k">def</span> <span class="nf">updateDims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">NX</span><span class="p">,</span> <span class="n">NY</span>
        <span class="c1"># nx, ny</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">NX</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">NY</span>
        <span class="c1"># minmaxZ</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmaxZ</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nElast</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">monipath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;moni&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.dat&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">monipath</span><span class="p">)):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] &quot;</span><span class="o">+</span><span class="n">monipath</span><span class="o">+</span><span class="s2">&quot; does not exist.&quot;</span><span class="p">)</span>
            <span class="c1">#monifile = open(monipath,&quot;r&quot;)</span>
            <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Disp&quot;</span><span class="p">,</span><span class="s2">&quot;Cont&quot;</span><span class="p">,</span><span class="s2">&quot;Dist&quot;</span><span class="p">]:</span> <span class="n">monidata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">monipath</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pres&quot;</span><span class="p">:</span> 
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fSteppedRamp</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vzConstCOM</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">monidata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">monipath</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                    <span class="c1">#print(&quot;moni:&quot;, monidata.min(), monidata.max()) # DEBUG</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">monidata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;maxStiff:&quot;</span><span class="p">,</span> <span class="n">monidata</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">monidata</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="c1"># DEBUG</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmaxZ</span> <span class="o">=</span> <span class="p">[</span><span class="n">monidata</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">monidata</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span></div>
</div>



<div class="viewcode-block" id="interSheet">
<a class="viewcode-back" href="../cmanim.html#cmanim.interSheet">[docs]</a>
<span class="k">class</span> <span class="nc">interSheet</span><span class="p">:</span>
    <span class="c1"># Defaults: should match contMech code</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">resolMovie</span> <span class="o">=</span> <span class="mi">512</span>
    <span class="n">fPotential</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fDumpFrame</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nFrames</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">increment</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;inter&quot;</span><span class="c1">#TODO: check if necessary</span>
    <span class="n">contFiles</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># file names</span>
    <span class="n">attrFiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newID</span><span class="p">):</span> 
        <span class="k">global</span> <span class="n">INCREMENT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">newID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="o">=</span> <span class="n">INCREMENT</span>

<div class="viewcode-block" id="interSheet.updateFiles">
<a class="viewcode-back" href="../cmanim.html#cmanim.interSheet.updateFiles">[docs]</a>
    <span class="k">def</span> <span class="nf">updateFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span><span class="c1">#, numFrames):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; sets up list of frame files belonging to this object &quot;&quot;&quot;</span>

        <span class="k">global</span> <span class="n">NFRAMES</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span> <span class="o">=</span> <span class="n">NFRAMES</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fDumpFrame</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to do in inter&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">))</span>
            <span class="k">return</span>
        
        <span class="c1"># konfigName</span>
        <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;.dat&quot;</span>
        <span class="k">if</span> <span class="n">VERSION</span> <span class="o">==</span> <span class="s2">&quot;dev&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;interaction class should not happen here.&quot;</span><span class="p">)</span><span class="c1">#DEBUG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">=</span> <span class="s2">&quot;frames/inter&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
        
        <span class="c1"># Individual profile file names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contFiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">iFrame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">iFrame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1">#iFrame += 1</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">+</span> <span class="s2">&quot;contact.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iFrame</span><span class="p">)</span> <span class="o">+</span> <span class="n">ending</span>
            <span class="c1">#print(&quot;-&gt; &quot;, file) #DEBUG</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">)):</span> <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">iFrame</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s2">&quot;does not exist.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nTime</span><span class="o">*</span><span class="p">(</span><span class="n">iFrame</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span> <span class="o">=</span> <span class="n">iFrame</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">attrFiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fPotential</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iFrame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">konfigName</span> <span class="o">+</span> <span class="s2">&quot;attract.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iFrame</span><span class="p">)</span> <span class="o">+</span> <span class="n">ending</span>
                <span class="c1">#print(&quot;-&gt; &quot;, file) #DEBUG</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">)):</span> 
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="s2">&quot;does not exist.&quot;</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Sanity check</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contFiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] No files found for inter &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fPotential</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contFiles</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrFiles</span><span class="p">):</span> 
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nFrames</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; frames, &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contFiles</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; cont and &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrFiles</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; attr files.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="interSheet.updateData">
<a class="viewcode-back" href="../cmanim.html#cmanim.interSheet.updateData">[docs]</a>
    <span class="k">def</span> <span class="nf">updateData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">numFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; reads and sets up the data file needed to plot the next frame &quot;&quot;&quot;</span>
        
        <span class="n">idx</span> <span class="o">=</span> <span class="n">START</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="o">*</span><span class="p">(</span><span class="n">numFrame</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">START</span><span class="p">)</span> <span class="c1"># numFrame starts at 1, not 0!</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fDumpFrame</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to do in inter&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="c1">#Adjust: CONVERSION!!!!</span>
            <span class="c1">#f = np.loadtxt(self.contFiles[idx]) </span>
            <span class="c1">#LX = XLIM[1] - XLIM[0]; LY = YLIM[1] - YLIM[0]</span>
            <span class="c1">#f[:,0] = f[:,0]*NX/LX; f[:,1] = f[:,1]*NY/LY;</span>
            <span class="c1">#f = np.ceil(f[1:,:]).astype(np.uint32)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contFiles</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">f</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># 1 is repulsive</span>
        <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Cont file #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numFrame</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; does not contain valid indices.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fPotential</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fATTRACT</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="c1">#Adjust: CONVERSION!!!!</span>
                <span class="c1">#f = np.loadtxt(self.contFiles[idx]) </span>
                <span class="c1">#LX = XLIM[1] - XLIM[0]; LY = YLIM[1] - YLIM[0]</span>
                <span class="c1">#f[:,0] = f[:,0]*NX/LX; f[:,1] = f[:,1]*NY/LY;</span>
                <span class="c1">#f = np.ceil(f[1:,:]).astype(np.uint32)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrFiles</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">f</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># -1 is attractive</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Attr file #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numFrame</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; does not contain valid indices.&quot;</span><span class="p">)</span>

        <span class="c1">#WIP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span></div>
</div>

        <span class="c1">#DEBUG</span>
        <span class="c1">#print(&quot;contact:&quot;, (self.data==1).sum()/(NX*NY))</span>
        <span class="c1">#print(&quot;attract:&quot;, (self.data==-1).sum()/(NX*NY))</span>





<span class="c1">#%% ----- Initialization ----- %%#</span>

<div class="viewcode-block" id="checkDir">
<a class="viewcode-back" href="../cmanim.html#cmanim.checkDir">[docs]</a>
<span class="k">def</span> <span class="nf">checkDir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Checks &lt;path&gt; directory for &quot;frames&quot; subfolder and &quot;params.out&quot;. &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;frames&quot;</span><span class="p">)):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] Could not find the subdirectory &#39;frames&#39;.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check for params.out file</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;params.out&quot;</span><span class="p">)):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] Could not find &#39;params.out&#39;.&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="initParams">
<a class="viewcode-back" href="../cmanim.html#cmanim.initParams">[docs]</a>
<span class="k">def</span> <span class="nf">initParams</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; initialize params.out</span>
<span class="sd">        </span>
<span class="sd">        reads &lt;path&gt;/params.out to recreate sheet and interaction setup,</span>
<span class="sd">        initializes them and checks corresponding files and data to determine</span>
<span class="sd">        optimal plot parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">XLIM</span><span class="p">,</span> <span class="n">YLIM</span><span class="p">,</span> <span class="n">ZLIM</span><span class="p">,</span> <span class="n">NX</span><span class="p">,</span> <span class="n">NY</span><span class="p">,</span> <span class="n">NFRAMES</span><span class="p">,</span> <span class="n">SHEET</span><span class="p">,</span> <span class="n">RAMP</span><span class="p">,</span> <span class="n">LABELS</span><span class="p">,</span> <span class="n">RESMOVIE</span>
    <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">paramsfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;params.out&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">freqFrame</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">nTime</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">dTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nSheet</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">lengthX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">lengthY</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">reading</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">paramsfile</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Read global parameters</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;# lengthX&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> 
            <span class="n">lengthX</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# lengthY&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> 
            <span class="n">lengthY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nxGlobal&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">NX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">NX</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nyGlobal&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">NY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">NY</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nTime&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">nTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# dTime&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">dTime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# freqFrame&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">freqFrame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# frameInterval&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">freqFrame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nSheet&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">nSheet</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1"># Read sheet parameters</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# sheet start&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> 
            <span class="n">SHEET</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gfmdSheet</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
            <span class="n">reading</span> <span class="o">=</span> <span class="s2">&quot;sheet&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nx #&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# ny #&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nElast&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nElast</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# stiffness0&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stiffness0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# fRough&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fRough</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="c1"># works for fRoughAdd and fRoughRead</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# fTopo&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fRough</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="c1"># works for fRoughAdd and fRoughRead</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# f3dMovie&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">f3dMovie</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# nVeloTurnStep&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nVeloTurnStep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# fSteppedRamp&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fSteppedRamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# vzConstCOM&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vzConstCOM</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# dzRamp&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dzRamp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# rampSteps&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rampPeriod</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# rampRelax&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rampPeriod</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# fKelvinVoigt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">SHEET</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fKelvinVoigt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1"># Read inter parameters</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# inter start&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> 
            <span class="n">INTER</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interSheet</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
            <span class="n">reading</span> <span class="o">=</span> <span class="s2">&quot;inter&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# fDumpFrame&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">INTER</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fDumpFrame</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# fPotential&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span> <span class="n">INTER</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fPotential</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;# resolMovie&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">reading</span><span class="o">==</span><span class="s2">&quot;inter&quot;</span><span class="p">):</span> <span class="n">INTER</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resolMovie</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    
    <span class="c1"># Update global params</span>
    <span class="k">if</span> <span class="n">NY</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">NY</span> <span class="o">=</span> <span class="n">NX</span>
    <span class="c1">#WIP</span>
    <span class="k">if</span> <span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">NX</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">NY</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lengthY</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">lengthY</span> <span class="o">=</span> <span class="n">lengthX</span>
    <span class="n">nFrames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nTime</span><span class="o">/</span><span class="n">freqFrame</span><span class="p">)</span>
    <span class="n">NFRAMES</span> <span class="o">=</span> <span class="n">nFrames</span> <span class="c1"># TODO: this needs to be adjusted if joining multiple paths</span>
    <span class="k">if</span> <span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">XLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">YLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    
    <span class="n">paramsfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1"># Update SHEET params</span>
    <span class="n">minima</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">maxima</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">nSheet</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">dTime</span> <span class="o">=</span> <span class="n">dTime</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nTime</span> <span class="o">=</span> <span class="n">nTime</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">lengthX</span> <span class="o">=</span> <span class="n">lengthX</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">lengthY</span> <span class="o">=</span> <span class="n">lengthY</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nFrames</span> <span class="o">=</span> <span class="n">nFrames</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">updateNxNy</span><span class="p">()</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">updateFiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">updateCols</span><span class="p">()</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">updateDims</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">rampName</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">RAMP</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">==</span><span class="s2">&quot;3D&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nElast</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">minima</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">minmaxZ</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">maxima</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">minmaxZ</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Update inter params</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Cont2D&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iInter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">INTER</span><span class="p">),</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">updateFiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resolMovie: &quot;</span><span class="p">,</span> <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">resolMovie</span><span class="p">)</span><span class="c1">#DEBUG</span>
            <span class="k">if</span> <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">resolMovie</span> <span class="o">&lt;</span> <span class="n">NX</span><span class="p">:</span>
                <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">NX</span> <span class="o">//</span> <span class="p">(</span> <span class="p">(</span><span class="n">NX</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">resolMovie</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">NX</span>
            <span class="k">if</span> <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">resolMovie</span> <span class="o">&lt;</span> <span class="n">NY</span><span class="p">:</span>
                <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">NY</span> <span class="o">//</span> <span class="p">(</span> <span class="p">(</span><span class="n">NY</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">resolMovie</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">INTER</span><span class="p">[</span><span class="n">iInter</span><span class="p">]</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">NY</span>
        <span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">INTER</span><span class="p">[</span><span class="n">IID</span><span class="p">]</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span>
        <span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">INTER</span><span class="p">[</span><span class="n">IID</span><span class="p">]</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>
    <span class="c1"># Update ZLIM</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">==</span><span class="s2">&quot;3D&quot;</span><span class="p">:</span>
        <span class="n">ZLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxima</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">minima</span><span class="p">)</span> <span class="c1"># TODO: what about joining paths in 3D?</span>
        <span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ZLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">ZLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ZLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">minima</span><span class="o">+</span><span class="p">[</span><span class="n">dummy</span><span class="p">])</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">maxima</span><span class="o">+</span><span class="p">[</span><span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">maxima</span><span class="o">+</span><span class="p">[</span><span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">minima</span><span class="o">+</span><span class="p">[</span><span class="n">dummy</span><span class="p">])</span>
    <span class="c1">#TODO What about 3D with more than 2 sheets?</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">==</span><span class="s2">&quot;3D&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;[ERROR] 3D currently only supported for 2 sheets.&quot;</span><span class="p">)</span>

    <span class="c1"># Update labels</span>
    <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSheet</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nElast</span><span class="p">:</span> <span class="n">LABELS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Elastic surface &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iSheet</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">LABELS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Rigid surface &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iSheet</span><span class="p">))</span></div>




<div class="viewcode-block" id="animate2D">
<a class="viewcode-back" href="../cmanim.html#cmanim.animate2D">[docs]</a>
<span class="k">def</span> <span class="nf">animate2D</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; run animation from 2D files &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">MODE</span><span class="p">,</span> <span class="n">XLIM</span><span class="p">,</span> <span class="n">YLIM</span><span class="p">,</span> <span class="n">ZLIM</span><span class="p">,</span> <span class="n">RAMP</span>

    <span class="c1"># Setup figure and axes</span>
    <span class="k">if</span> <span class="n">RAMP</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;normal displacement (&quot;</span><span class="o">+</span><span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;force (&quot;</span><span class="o">+</span><span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;pressure (&quot;</span><span class="o">+</span><span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">GRID</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">XRAMP</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">XRAMP</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">XRAMP</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">YRAMP</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">YRAMP</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">YRAMP</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">5.6</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>

    <span class="c1"># Setup coordinate labels and ranges</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Cont&quot;</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span>   <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="n">axlim</span> <span class="o">=</span> <span class="n">XLIM</span>
        <span class="k">elif</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="n">axlim</span> <span class="o">=</span> <span class="n">YLIM</span>
        <span class="k">elif</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span><span class="p">:</span>
            <span class="n">axlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">XLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">YLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)]</span>
            <span class="n">axlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">axlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">axlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">axlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;lateral coordinate &quot;</span> <span class="o">+</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Disp&quot;</span><span class="p">:</span> 
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;normal displacement (&quot;</span><span class="o">+</span><span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ZLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Pres&quot;</span><span class="p">:</span> <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pressure Z (&quot;</span><span class="o">+</span><span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>

    <span class="c1"># Lists of plot objects</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)</span>
    <span class="n">lineColor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">);</span>
    
    <span class="c1"># ax1: Contact movie</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Cont&quot;</span><span class="p">:</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lengthX</span> <span class="o">/</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lengthY</span><span class="c1"># * len(RESMOVIE[1]) / len(RESMOVIE[0])</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">INTER</span><span class="p">[</span><span class="n">IID</span><span class="p">]</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span><span class="n">INTER</span><span class="p">[</span><span class="n">IID</span><span class="p">]</span><span class="o">.</span><span class="n">ny</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">get_images</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lines1</span> <span class="o">=</span> <span class="n">im</span><span class="p">,</span>
        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
            <span class="n">lineColor</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">iSheet</span><span class="p">]</span>

    <span class="c1"># ax1: Profile animation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nElast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="c1">#pobj, = ax1.plot(SHEET[iSheet].data[:,0], SHEET[iSheet].data[:,1], label=LABELS[iSheet])</span>
                <span class="c1">#lineColor[iSheet] = pobj.get_color()</span>
                <span class="n">pobj</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="c1">#FILL</span>
                <span class="n">lineColor</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pobj</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">ls</span><span class="o">=</span><span class="n">LINESTYLE</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">MARKERSTYLE</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">LABELS</span><span class="p">[</span><span class="n">iSheet</span><span class="p">])</span>
                <span class="n">lineColor</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">pobj</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
            <span class="n">lines1</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">pobj</span>
    
    <span class="c1"># ax2: Ramp animation</span>
    <span class="k">if</span> <span class="n">RAMP</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">fSteppedRamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">rampName</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;µ&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1e6</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mm&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;N&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">lengthX</span><span class="o">*</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">lengthY</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;m&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;k&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
                <span class="c1">#print(&quot;-&gt; loaded ramp&quot;) #DEBUG</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">vzConstCOM</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">rampName</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                <span class="c1">#print(&quot;-&gt; loaded moni&quot;) #DEBUG</span>
                <span class="c1">#if SHEET[iSheet].fKelvinVoigt: SHEET[iSheet].ramp[:,0] = SHEET[iSheet].ramp[:,0] - 0.3e-6#QUICKFIX_KV</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;N&quot;</span><span class="p">:</span>
                    <span class="n">area</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">lengthX</span><span class="o">*</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">lengthY</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">area</span>
                <span class="c1">#else: &quot;Pa&quot;</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;m&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span>
                <span class="k">if</span> <span class="n">UNITS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;k&quot;</span><span class="p">:</span>
                    <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
                <span class="c1">#SHEET[iSheet].ramp[:,1] = 0.853*SHEET[iSheet].ramp[:,1]#QUICKFIX_KV_DIRTY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines2</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
                <span class="c1">#print(&quot;-&gt; loaded nothing&quot;) #DEBUG</span>
                <span class="k">continue</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> 
                     <span class="n">label</span><span class="o">=</span><span class="n">LABELS</span><span class="p">[</span><span class="n">iSheet</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lineColor</span><span class="p">[</span><span class="n">iSheet</span><span class="p">])</span>
            <span class="n">pobj</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[</span><span class="n">START</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[</span><span class="n">START</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lineColor</span><span class="p">[</span><span class="n">iSheet</span><span class="p">])</span>
            <span class="n">lines2</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">pobj</span>
    <span class="k">if</span> <span class="n">ADDRAMP</span><span class="p">[</span><span class="s2">&quot;plot&quot;</span><span class="p">]:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ADDRAMP</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span><span class="n">ADDRAMP</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span><span class="n">ADDRAMP</span><span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">ADDRAMP</span><span class="p">[</span><span class="s2">&quot;lab&quot;</span><span class="p">])</span>


    <span class="k">if</span> <span class="n">RAMP</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> <span class="c1"># looks better with wide plot</span>

    

    <span class="k">def</span> <span class="nf">updateFrame</span><span class="p">(</span><span class="n">iFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; actual animator function</span>

<span class="sd">        goes through all sheet and inter objects and reads in an updates </span>
<span class="sd">        corresponding data for the next frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Update objects</span>
        <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Cont&quot;</span><span class="p">:</span> <span class="n">INTER</span><span class="p">[</span><span class="n">IID</span><span class="p">]</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="n">iFrame</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
            <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="n">iFrame</span><span class="p">)</span>

        <span class="c1"># Contact movie</span>
        <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Cont&quot;</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">lines1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">im</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">INTER</span><span class="p">[</span><span class="n">IID</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Profile animation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Adjust: offset so that rigid body is moving, elastic one is still</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            offset = 0; numElast = 0</span>
<span class="sd">            for iSheet in range(len(SHEET)):</span>
<span class="sd">                if SHEET[iSheet].nElast: </span>
<span class="sd">                    numElast += 1</span>
<span class="sd">                    offset += SHEET[iSheet].data[0,1]</span>
<span class="sd">            offset /= numElast</span>
<span class="sd">            #Adjust end &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">iSheet</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines1</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nElast</span><span class="p">:</span> <span class="k">continue</span> <span class="c1">#Adjust</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="c1"># - offset) #Adjust</span>
                <span class="c1">#if not SHEET[iSheet].nElast: continue #Adjust</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Elastic surface &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iSheet</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; Frame &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iFrame</span><span class="p">))</span>

        <span class="c1"># Ramp animation</span>
        <span class="k">if</span> <span class="n">RAMP</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iSheet</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines2</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">rampName</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="k">continue</span>
                <span class="c1"># TODO interpolate in case frames and ramp are not in sync:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">START</span> <span class="o">+</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span><span class="o">*</span><span class="nb">int</span><span class="p">((</span><span class="n">iFrame</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">START</span><span class="p">))</span>
                <span class="n">idx</span> <span class="o">*=</span> <span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">)</span><span class="o">/</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nFrames</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="c1">#print(&quot;-&gt;&quot;,str(idx))#DEBUG</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">ramp</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Return plot objects</span>
        <span class="k">if</span> <span class="n">RAMP</span><span class="p">:</span> <span class="k">return</span> <span class="n">lines1</span><span class="p">,</span> <span class="n">lines2</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Legend updates each time. if RAMP, no second legend needed</span>
            <span class="k">if</span> <span class="n">MODE</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Cont&quot;</span><span class="p">:</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">lines1</span>
    
    
    <span class="k">def</span> <span class="nf">updateTime</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; counts up and loops frame index &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">t</span><span class="o">&lt;</span><span class="n">NFRAMES</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">t</span><span class="o">%</span><span class="n">NFRAMES</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">START</span>
    
    
    <span class="k">def</span> <span class="nf">keyPress</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; adds pause/play and reverse/forward during animation playback &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">animObj</span><span class="o">.</span><span class="n">running</span><span class="p">:</span> <span class="n">animObj</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">animObj</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">animObj</span><span class="o">.</span><span class="n">running</span> <span class="o">^=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
        <span class="c1"># Manually update the plot</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">animObj</span><span class="o">.</span><span class="n">frame_seq</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">updateFrame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="n">keyPress</span><span class="p">)</span>
    
    <span class="c1"># Run the animation</span>
    <span class="n">animObj</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">updateFrame</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">updateTime</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="n">FPS</span><span class="p">,</span> <span class="n">save_count</span><span class="o">=</span><span class="n">NFRAMES</span><span class="p">)</span>
    <span class="n">animObj</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">animObj</span><span class="p">)</span></div>




<div class="viewcode-block" id="animate3D">
<a class="viewcode-back" href="../cmanim.html#cmanim.animate3D">[docs]</a>
<span class="k">def</span> <span class="nf">animate3D</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; run animation from 3D files &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">MODE</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lengthX</span> <span class="o">/</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lengthY</span><span class="c1"># * len(RESMOVIE[1]) / len(RESMOVIE[0])</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">RESMOVIE</span><span class="p">[</span><span class="mi">1</span><span class="p">]))),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Cont3D&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">clim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Press3D&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">clim</span><span class="p">(</span><span class="o">-</span><span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stiffness0</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stiffness0</span><span class="o">/</span><span class="mi">40</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">clim</span><span class="p">(</span><span class="n">ZLIM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ZLIM</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#ax.set_xticks(np.arange(5)*NX/4)</span>
    <span class="c1">#ax.set_xticklabels([str((XLIM[1]-XLIM[0])*val/4) for val in range(5)])</span>
    <span class="c1">#ax.set_yticks(np.arange(5)*NY/4)</span>
    <span class="c1">#ax.set_yticklabels([str((YLIM[1]-YLIM[0])*val/4) for val in range(5)])</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="o">!=</span><span class="s2">&quot;Cont3D&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">updateFrame</span><span class="p">(</span><span class="n">iFrame</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; actual animator function</span>

<span class="sd">        goes through all sheet objects and reads in an updates </span>
<span class="sd">        corresponding data for the next frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">updateData</span><span class="p">(</span><span class="n">iFrame</span><span class="p">)</span>
        <span class="c1">#TODO might want to be transposed or rot90 is correct</span>
        <span class="k">if</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Cont3D&quot;</span><span class="p">:</span> <span class="n">array</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Press3D&quot;</span><span class="p">:</span> <span class="n">array</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c1"># != 0 # &lt; -SHEET[1].stiffness0/100</span>
        <span class="k">elif</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Dist3D&quot;</span><span class="p">:</span> <span class="n">array</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="n">MODE</span><span class="o">==</span><span class="s2">&quot;Disp3D&quot;</span><span class="p">:</span> <span class="n">array</span> <span class="o">=</span> <span class="n">SHEET</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">im</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">im</span><span class="p">,</span>
    
    
    <span class="k">def</span> <span class="nf">updateTime</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; counts up and loops frame index &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">START</span>
        <span class="k">while</span> <span class="n">t</span><span class="o">&lt;</span><span class="n">NFRAMES</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span>
            <span class="k">yield</span> <span class="n">t</span><span class="o">%</span><span class="n">NFRAMES</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">START</span>
    

    <span class="k">def</span> <span class="nf">keyPress</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; adds pause/play and reverse/forward during animation playback &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">animObj</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="n">animObj</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">animObj</span><span class="o">.</span><span class="n">event_source</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">animObj</span><span class="o">.</span><span class="n">running</span> <span class="o">^=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
            <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
            <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
        <span class="c1"># Manually update the plot</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">animObj</span><span class="o">.</span><span class="n">frame_seq</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">updateFrame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="n">keyPress</span><span class="p">)</span>
    
    <span class="n">animObj</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">updateFrame</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">updateTime</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="n">FPS</span><span class="p">,</span> <span class="n">save_count</span><span class="o">=</span><span class="n">NFRAMES</span><span class="p">)</span>
    <span class="n">animObj</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">animObj</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">animObj</span><span class="p">)</span></div>

    

<div class="viewcode-block" id="dataReset">
<a class="viewcode-back" href="../cmanim.html#cmanim.dataReset">[docs]</a>
<span class="k">def</span> <span class="nf">dataReset</span><span class="p">():</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot; hard reset &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">SHEET</span><span class="p">,</span> <span class="n">NX</span><span class="p">,</span> <span class="n">NY</span><span class="p">,</span> <span class="n">XLIM</span><span class="p">,</span><span class="n">YLIM</span><span class="p">,</span> <span class="n">ZLIM</span><span class="p">,</span> <span class="n">NFRAMES</span>
    <span class="k">del</span> <span class="n">SHEET</span><span class="p">[:],</span> <span class="n">INTER</span><span class="p">[:]</span>
    <span class="n">NX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">NY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">XLIM</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span> <span class="n">YLIM</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ZLIM</span> <span class="o">=</span> <span class="p">[</span><span class="o">+</span><span class="mf">1.0e+38</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0e+38</span><span class="p">]</span>
    <span class="n">NFRAMES</span> <span class="o">=</span> <span class="mi">1</span></div>




<div class="viewcode-block" id="save">
<a class="viewcode-back" href="../cmanim.html#cmanim.save">[docs]</a>
<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">animation</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; save animation to file </span>

<span class="sd">    For mp4 files, make sure ffmpg and h264 are installed correctly:</span>
<span class="sd">    conda install -c conda-forge ffmpeg</span>
<span class="sd">    conda install -c conda-forge x264=20131218</span>

<span class="sd">    (see: https://stackoverflow.com/questions/13316397/matplotlib-animation-no-moviewriters-available)</span>
<span class="sd">    (see: https://github.com/sigsep/sigsep-mus-db/issues/14)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">==</span><span class="s2">&quot;mp4&quot;</span><span class="p">:</span> 
        <span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FFMpegWriter</span>
        <span class="n">ffmpeg</span> <span class="o">=</span> <span class="n">FFMpegWriter</span><span class="p">(</span><span class="n">fps</span><span class="o">=</span><span class="n">FPS</span><span class="p">)</span>
        <span class="n">animation</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="n">ffmpeg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">animation</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;imagemagick&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">FPS</span><span class="p">)</span></div>




<div class="viewcode-block" id="initGlobals">
<a class="viewcode-back" href="../cmanim.html#cmanim.initGlobals">[docs]</a>
<span class="k">def</span> <span class="nf">initGlobals</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; initializes global parameters</span>
<span class="sd">    </span>
<span class="sd">    goes through all simulation directories in &lt;paths&gt; and tries to find optimal </span>
<span class="sd">    parameters to plot all simulations into one animation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">SHOW</span><span class="p">,</span> <span class="n">FPS</span><span class="p">,</span> <span class="n">LINESTYLE</span><span class="p">,</span> <span class="n">MARKERSTYLE</span><span class="p">,</span> <span class="n">MODE</span><span class="p">,</span> <span class="n">VERSION</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">NX</span><span class="p">,</span> <span class="n">NY</span><span class="p">,</span> <span class="n">XLIM</span><span class="p">,</span> <span class="n">YLIM</span><span class="p">,</span> <span class="n">ZLIM</span><span class="p">,</span> <span class="n">XRAMP</span><span class="p">,</span> <span class="n">YRAMP</span><span class="p">,</span> <span class="n">INCREMENT</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span><span class="p">,</span> <span class="n">NFRAMES</span><span class="p">,</span> <span class="n">RAMP</span><span class="p">,</span> <span class="n">IID</span>

    <span class="c1"># Init prams file: TODO: before or after the rest of this function?</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;input.py&quot;</span><span class="p">)):</span>
        <span class="kn">import</span> <span class="nn">input</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using input.py&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">SHOW</span><span class="p">:</span>      <span class="n">SHOW</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">SHOW</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">FPS</span><span class="p">:</span>       <span class="n">FPS</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">FPS</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">LINESTYLE</span><span class="p">:</span> <span class="n">LINESTYLE</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">LINESTYLE</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">MARKERSTYLE</span><span class="p">:</span> <span class="n">MARKERSTYLE</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">MARKERSTYLE</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">MODE</span><span class="p">:</span>      <span class="n">MODE</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">MODE</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">VERSION</span><span class="p">:</span>   <span class="n">VERSION</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">VERSION</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">NX</span><span class="p">:</span>        <span class="n">NX</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">NX</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">NY</span><span class="p">:</span>        <span class="n">NY</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">NY</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">XLIM</span><span class="p">:</span>      <span class="n">XLIM</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">XLIM</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">YLIM</span><span class="p">:</span>      <span class="n">YLIM</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">YLIM</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">XRAMP</span><span class="p">:</span>     <span class="n">XRAMP</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">XRAMP</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">YRAMP</span><span class="p">:</span>     <span class="n">YRAMP</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">YRAMP</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">INCREMENT</span><span class="p">:</span> <span class="n">INCREMENT</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">INCREMENT</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">ZLIM</span><span class="p">:</span>      <span class="n">ZLIM</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">ZLIM</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">START</span><span class="p">:</span>     <span class="n">START</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">START</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">END</span><span class="p">:</span>       <span class="n">END</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">END</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">NFRAMES</span><span class="p">:</span>   <span class="n">NFRAMES</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">NFRAMES</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">RAMP</span><span class="p">:</span>      <span class="n">RAMP</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">RAMP</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">IID</span><span class="p">:</span>       <span class="n">IID</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">IID</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">UNITS</span><span class="p">:</span>     <span class="n">UNITS</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">UNITS</span>
        <span class="k">return</span>

    <span class="c1"># Only relevant for joining multiple paths:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">travelPerFrame</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nElast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">travelPerFrame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">vzConstCOM</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">travelPerFrame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">vzConstCOM</span><span class="o">*</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">dTime</span><span class="o">*</span>
                                           <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nTime</span><span class="o">/</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nFrames</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">travelPerFrame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nTime</span> <span class="o">*</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">dzRamp</span> <span class="o">/</span> 
                                            <span class="p">(</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">rampPeriod</span> <span class="o">*</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nFrames</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">travelRef</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">travelPerFrame</span><span class="p">)</span>
        <span class="n">nFrames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">travelPerFrame</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span> <span class="o">=</span> <span class="n">INCREMENT</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">travelRef</span><span class="o">/</span><span class="n">travelPerFrame</span><span class="p">[</span><span class="n">iSheet</span><span class="p">])</span>
                <span class="n">nFrames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">nFrames</span><span class="o">/</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span> <span class="p">)</span>
        
        <span class="c1"># Update NFRAMES</span>
        <span class="k">if</span> <span class="n">END</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">NFRAMES</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nFrames</span><span class="o">+</span><span class="p">[</span><span class="n">END</span><span class="p">])</span> <span class="o">-</span> <span class="n">START</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">NFRAMES</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nFrames</span><span class="p">)</span> <span class="o">-</span> <span class="n">START</span><span class="p">)</span></div>





<div class="viewcode-block" id="dumpGlobals">
<a class="viewcode-back" href="../cmanim.html#cmanim.dumpGlobals">[docs]</a>
<span class="k">def</span> <span class="nf">dumpGlobals</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; shows automatically adjusted parameters for user to check &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Path:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SHOW =&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">SHOW</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FPS =&quot;</span><span class="p">,</span> <span class="n">FPS</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DPI =&quot;</span><span class="p">,</span> <span class="n">DPI</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GRID = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">GRID</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LINESTYLE = </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">LINESTYLE</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MARKERSTYLE = </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MARKERSTYLE</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LABELS = </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">LABELS</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODE = </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MODE</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VERSION = </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">VERSION</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UNITS = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">UNITS</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NX = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">NX</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NY = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">NY</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;XLIM = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">XLIM</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;YLIM = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">YLIM</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ZLIM = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ZLIM</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;XRAMP = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">XRAMP</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;YRAMP = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">YRAMP</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INCREMENT = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">INCREMENT</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;START = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">START</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;END = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">END</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NFRAMES = </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">NFRAMES</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RAMP = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">RAMP</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IID = </span><span class="si">%i</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">IID</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESMOVIE = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">RESMOVIE</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">iSheet</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHEET</span><span class="p">)):</span>
        <span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span> <span class="o">=</span> <span class="n">INCREMENT</span><span class="o">*</span><span class="n">SHEET</span><span class="p">[</span><span class="n">iSheet</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span></div>

        <span class="c1">#if SHEET[iSheet].nElast:#DEBUG</span>
        <span class="c1">#    print(&quot;SHEET[&quot;+str(iSheet)+&quot;] increment: &quot;, SHEET[iSheet].increment)</span>


<div class="viewcode-block" id="init">
<a class="viewcode-back" href="../cmanim.html#cmanim.init">[docs]</a>
<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">MODE</span><span class="p">;</span> <span class="n">MODE</span> <span class="o">=</span> <span class="n">mode</span>
    <span class="n">dataReset</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span> <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">checkDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">initParams</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">initGlobals</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="n">dumpGlobals</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span></div>


<div class="viewcode-block" id="run">
<a class="viewcode-back" href="../cmanim.html#cmanim.run">[docs]</a>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">MODE</span>
    <span class="k">if</span> <span class="n">MODE</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;3D&quot;</span><span class="p">:</span> <span class="n">animation</span> <span class="o">=</span> <span class="n">animate3D</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">animation</span> <span class="o">=</span> <span class="n">animate2D</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span></div>






<span class="c1">#%% ----- Functions for use in iPython console ----- %%#</span>


<div class="viewcode-block" id="runDispX">
<a class="viewcode-back" href="../cmanim.html#cmanim.runDispX">[docs]</a>
<span class="k">def</span> <span class="nf">runDispX</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates displacement along X direction</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;DispX&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="runDispY">
<a class="viewcode-back" href="../cmanim.html#cmanim.runDispY">[docs]</a>
<span class="k">def</span> <span class="nf">runDispY</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates displacement along Y direction</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;DispY&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="runDispD">
<a class="viewcode-back" href="../cmanim.html#cmanim.runDispD">[docs]</a>
<span class="k">def</span> <span class="nf">runDispD</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates displacement along diagonal direction</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;DispD&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="runCont2D">
<a class="viewcode-back" href="../cmanim.html#cmanim.runCont2D">[docs]</a>
<span class="k">def</span> <span class="nf">runCont2D</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates contact movie from interSheet frames</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;Cont2D&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="runCont3D">
<a class="viewcode-back" href="../cmanim.html#cmanim.runCont3D">[docs]</a>
<span class="k">def</span> <span class="nf">runCont3D</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates contact movie from sheet configs &quot;&quot;&quot;</span>

    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;Cont3D&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="runDisp3D">
<a class="viewcode-back" href="../cmanim.html#cmanim.runDisp3D">[docs]</a>
<span class="k">def</span> <span class="nf">runDisp3D</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates displacement movie from elastic sheet config &quot;&quot;&quot;</span>

    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;Disp3D&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="runDist3D">
<a class="viewcode-back" href="../cmanim.html#cmanim.runDist3D">[docs]</a>
<span class="k">def</span> <span class="nf">runDist3D</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates surface distance movie from sheet configs &quot;&quot;&quot;</span>

    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;Dist3D&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>




<div class="viewcode-block" id="runPressX">
<a class="viewcode-back" href="../cmanim.html#cmanim.runPressX">[docs]</a>
<span class="k">def</span> <span class="nf">runPressX</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates pressure along X direction</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Pressure animation supported as of contMech version March 2021.&quot;</span><span class="p">)</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;PressX&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>

    

<div class="viewcode-block" id="runPressY">
<a class="viewcode-back" href="../cmanim.html#cmanim.runPressY">[docs]</a>
<span class="k">def</span> <span class="nf">runPressY</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates displacement along Y direction</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Pressure animation supported as of contMech version March 2021.&quot;</span><span class="p">)</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;PressY&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>

    

<div class="viewcode-block" id="runPressD">
<a class="viewcode-back" href="../cmanim.html#cmanim.runPressD">[docs]</a>
<span class="k">def</span> <span class="nf">runPressD</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">morepaths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; animates displacement along diagonal direction</span>

<span class="sd">    with stress-displacement curve if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Pressure animation supported as of contMech version March 2021.&quot;</span><span class="p">)</span>
    <span class="n">init</span><span class="p">(</span><span class="s2">&quot;PressD&quot;</span><span class="p">,[</span><span class="n">path</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">morepaths</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">run</span><span class="p">()</span> <span class="p">)</span></div>



<div class="viewcode-block" id="reanimate">
<a class="viewcode-back" href="../cmanim.html#cmanim.reanimate">[docs]</a>
<span class="k">def</span> <span class="nf">reanimate</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; runs the previous animation again.</span>

<span class="sd">    helpful after manually changing parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initGlobals</span><span class="p">([</span><span class="s2">&quot;.&quot;</span><span class="p">])</span>
    <span class="n">animation</span> <span class="o">=</span> <span class="n">animate2D</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">SHOW</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span></div>


</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">cmutils 0.0.1 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cmanim</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Christian Mueller.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>